# 테스트 작성 가이드

## 1. 프로젝트 테스트 구조

테스트 코드는 `react-shop-vite-tdd-client/` 디렉토리에 위치하며, 프로젝트의 실제 구조에 따라 다음과 같이 구성됩니다.

```
react-shop-vite-tdd-client/
├── cypress/             # Cypress E2E 테스트
│   ├── e2e/             # E2E 테스트
│   │   ├── order.cy.js  # 주문 프로세스 테스트
│   ├── fixtures/        # 테스트 데이터
│   │   ├── example.json # 예제 데이터
│   ├── support/         # 테스트 지원 파일
│   │   ├── commands.js  # 커스텀 명령어
│   │   ├── e2e.js       # E2E 설정 파일
├── src/                 # 소스 코드
│   ├── pages/           # 페이지 단위 컴포넌트
│   │   ├── CompletePage/
│   │   │   ├── tests/   # CompletePage 관련 테스트
│   │   │   │   ├── CompletePage.test.jsx
│   │   ├── OrderPage/
│   │   │   ├── tests/   # OrderPage 관련 테스트
│   │   │   │   ├── Type.test.jsx
│   │   │   │   ├── calculate.test.jsx
│   │   ├── SummaryPage/
│   │   │   ├── tests/   # SummaryPage 관련 테스트
│   │   │   │   ├── SummaryPage.test.jsx
│   │   ├── WishlistPage/
│   │   │   ├── tests/   # WishlistPage 관련 테스트
│   │   │   │   ├── WishlistPage.test.jsx
│   ├── services/        # API 요청 및 데이터 관리
│   │   ├── tests/       # 서비스 관련 테스트
│   │   │   ├── PaymentService.test.js
│   ├── utils/           # 유틸리티 함수
│   │   ├── tests/       # 유틸리티 함수 관련 테스트
│   │   │   ├── processPayment.test.js
│   ├── App.test.jsx     # App 컴포넌트 테스트
```

- **Cypress E2E 테스트**
  - `cypress/e2e/`: E2E 테스트 파일 (`order.cy.js`)
  - `cypress/fixtures/`: 테스트 데이터 (`example.json`)
  - `cypress/support/`: 테스트 지원 파일 (`commands.js`, `e2e.js`)

- **vitest 코드 테스트**
  - `src/pages/`: 페이지 단위 컴포넌트 관련 테스트
    - 각 페이지 폴더 내 `tests/` 디렉토리에 테스트 파일 존재
  - `src/services/tests/`: 서비스 관련 테스트 (`PaymentService.test.js`)
  - `src/utils/tests/`: 유틸리티 함수 관련 테스트 (`processPayment.test.js`)
  - `src/`: 루트 컴포넌트 테스트 (`App.test.jsx`)

## 2. 테스트 파일 작성 규칙

### 파일 명명 규칙
- 테스트 파일은 `.test.js` 또는 `.test.jsx` 확장자를 사용합니다.
- 파일명은 테스트 대상을 명확히 표현합니다.
  - 예시: `Type.test.jsx`, `processPayment.test.js`

### 테스트 설명 (테스트 케이스명)
- 테스트 설명은 명확하고 구체적으로 작성합니다.
  - 예시: `상품 개수 변경 시 총 가격이 올바르게 계산된다`

```jsx
// ❌ 나쁜 예
 test("checkbox and button", () => { ... });

// ✅ 좋은 예
 test("주문 확인 체크박스를 클릭하지 않으면 결제 버튼이 비활성화 상태여야 한다", () => { ... });
```

## 3. 테스트 코드 패턴

### 📌 기본 테스트 구조

```jsx
describe("테스트 그룹명", () => {
  test("테스트 설명", () => {
    // 테스트 코드
    expect(true).toBe(true);
  });
});
```

## 4. 선택자(Locator) 전략

테스트에서 요소를 찾을 때 접근성 우선 순위를 고려해야 합니다. 아래 기준을 따르는 것이 좋습니다.

### 우선순위
```jsx
// 1. Role과 접근성 속성 (최우선)
await screen.findByRole('button', { name: '로그인' });
await screen.findByLabelText('이메일');
await screen.findByRole('textbox', { name: '비밀번호' });
await screen.findByRole('heading', { name: '회원가입' });

// 2. 텍스트 및 기타
await screen.findByText('계정 만들기');
await screen.findByPlaceholderText('이메일을 입력하세요');

// 3. 테스트 ID (Role과 접근성 속성으로 선택이 어려운 경우에 사용)
// ⚠️ 사용 전 반드시 해당 요소에 data-testid 속성이 정의되어 있는지 확인
// 가장 마지막 우선순위.
// 예) getByTestId('login-button')
await screen.findByTestId('submit-button');

// ❌ 피해야 할 방식 (안티 패턴)
screen.getByClassName('.login-btn');
screen.getBySelector('div > button');
```

## 4. 테스트 작성 예제

### 📌 상품 주문 및 가격 계산 테스트 (`App.test.jsx`, `calculate.test.jsx` 참고)
### 📌 옵션 선택 UI 상태 변화 테스트 (`Type.test.jsx` 참고)


## 5. 검증(Assertions) 가이드

| 유형        | 예제                                                              |
| --------- | --------------------------------------------------------------- |
| 요소 존재 확인  | `expect(screen.getByRole("button")).toBeInTheDocument();`       |
| 텍스트 포함 확인 | `expect(screen.getByText("총 금액")).toHaveTextContent("5,000원");` |
| 요소 활성화 여부 | `expect(screen.getByRole("button")).toBeEnabled();`             |
| 비활성화 확인   | `expect(screen.getByRole("button")).toBeDisabled();`            |

## 6. 테스트 데이터 및 Mocking

### 📌 API Mocking (MSW 활용)
다음과 같은 경우에만 API 모킹을 사용합니다:
- 외부 API 의존성이 있는 경우
- 테스트 환경에서 실제 API가 사용 불가능한 경우
- 특정 에러 상황 테스트가 필요한 경우


```jsx
// 특정 에러 상황 테스트를 위한 모킹 예시
   describe("에러 처리", () => {
        beforeEach(() => {
            // API 요청이 실패하도록 MSW 핸들러 재정의
            server.use(
                http.get("http://localhost:5003/order-history", () => {
                    return new Response(null, { status: 500 });
                })
            );
        });

        test("API 요청 실패 시 에러 메시지가 표시된다", async () => {
            renderWithContext(<CompletePage />);
            
            const errorBanner = await screen.findByTestId("error-banner");
            expect(errorBanner).toBeInTheDocument();
            expect(errorBanner).toHaveTextContent(MESSAGES.ERROR);
        });
    });
```
---

이 문서는 `@testing-library/react`와 `vitest`를 사용한 React 컴포넌트 테스트 가이드입니다. 위의 원칙을 준수하여 일관된 테스트를 작성하면 유지보수가 쉬워지고, 코드 품질이 향상됩니다.
